<template>
    <footer class="footer bg-neutral text-neutral-content p-10">
        <nav>
            <h6 class="footer-title">Legal</h6>
            <a class="link link-hover">Terms of use</a>
            <a class="link link-hover">Privacy policy</a>
            <a class="link link-hover">Cookie policy</a>
        </nav>
        <nav>
            <h6 class="footer-title">其他网站</h6>
            <a class="link link-hover" href="https://www.yuelili.com/" target="_blank">万事屋</a>
            <a class="link link-hover" href="https://www.yuelili.com/" target="_blank">导航站</a>
        </nav>

        <nav>
            <h6 class="footer-title">联系</h6>

            <div class="flex">
                <svg
                    t="1720597560184"
                    class="icon"
                    viewBox="0 0 1024 1024"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    p-id="4438"
                    width="20"
                    height="20">
                    <path
                        d="M498.894518 100.608396c-211.824383 0-409.482115 189.041494-409.482115 422.192601 0 186.567139 127.312594 344.783581 295.065226 400.602887 21.13025 3.916193 32.039717-9.17701 32.039717-20.307512 0-10.101055 1.176802-43.343157 1.019213-78.596056-117.448946 25.564235-141.394311-49.835012-141.394311-49.835012-19.225877-48.805566-46.503127-61.793368-46.503127-61.793368-38.293141-26.233478 3.13848-25.611308 3.13848-25.611308 42.361807 2.933819 64.779376 43.443441 64.779376 43.443441 37.669948 64.574714 98.842169 45.865607 122.912377 35.094286 3.815909-27.262924 14.764262-45.918819 26.823925-56.431244-93.796246-10.665921-192.323237-46.90017-192.323237-208.673623 0-46.071292 16.498766-83.747379 43.449581-113.332185-4.379751-10.665921-18.805298-53.544497 4.076852-111.732757 0 0 35.46063-11.336186 116.16265 43.296085 33.653471-9.330506 69.783343-14.022365 105.654318-14.174837 35.869952 0.153496 72.046896 4.844332 105.753579 14.174837 80.606853-54.631248 116.00813-43.296085 116.00813-43.296085 22.935362 58.18826 8.559956 101.120049 4.180206 111.732757 27.052123 29.584806 43.443441 67.260893 43.443441 113.332185 0 162.137751-98.798167 197.850114-192.799074 208.262254 15.151072 13.088086 28.65155 38.804794 28.65155 78.17957 0 56.484456-0.459464 101.94381-0.459464 115.854635 0 11.235902 7.573489 24.381293 29.014824 20.2543C825.753867 867.330798 933.822165 709.10924 933.822165 522.700713c0-233.155201-224.12657-422.192601-434.927647-422.192601L498.894518 100.608396z"
                        fill="#ffffff"
                        p-id="4439"></path>
                </svg>
                <a class="link link-hover ml-1" href="https://github.com/Yuelioi" target="_blank">
                    Github
                </a>
            </div>

            <div class="flex">
                <svg
                    t="1720597659813"
                    class="icon"
                    viewBox="0 0 1024 1024"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    p-id="5479"
                    width="20"
                    height="20">
                    <path
                        fill="#ffffff"
                        d="M306.005333 117.632L444.330667 256h135.296l138.368-138.325333a42.666667 42.666667 0 1 1 60.373333 60.373333l-78.037333 77.952L789.333333 256A149.333333 149.333333 0 0 1 938.666667 405.333333v341.333334a149.333333 149.333333 0 0 1-149.333334 149.333333h-554.666666A149.333333 149.333333 0 0 1 85.333333 746.666667v-341.333334A149.333333 149.333333 0 0 1 234.666667 256h88.96L245.632 177.962667a42.666667 42.666667 0 0 1 60.373333-60.373334zM789.333333 341.333333h-554.666666a64 64 0 0 0-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0 0 57.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0 0 63.701334-57.813334L853.333333 746.666667v-341.333334A64 64 0 0 0 789.333333 341.333333zM341.333333 469.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v85.333333a42.666667 42.666667 0 1 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666666-42.666667z m341.333334 0a42.666667 42.666667 0 0 1 42.666666 42.666667v85.333333a42.666667 42.666667 0 1 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666667-42.666667z"
                        p-id="5480"></path>
                </svg>
                <a
                    class="link link-hover ml-1"
                    href="https://space.bilibili.com/4279370"
                    target="_blank">
                    Bilibili</a
                >
            </div>
            <div class="flex">
                <svg
                    t="1720597814313"
                    class="icon"
                    viewBox="0 0 1024 1024"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    p-id="6692"
                    width="20"
                    height="20">
                    <path
                        d="M116.435 593.714c-33.54 78.964-38.985 154.297-12.059 168.37 18.572 9.696 47.686-12.382 74.936-52.909 10.791 44.157 37.493 84.137 75.633 116.21-40.004 14.768-66.135 38.886-66.135 66.232 0 44.954 70.709 81.302 157.978 81.302 78.716 0 143.907-29.538 155.94-68.371 3.232-0.049 15.663-0.049 18.796 0 12.083 38.784 77.324 68.371 155.989 68.371 87.267 0 157.978-36.398 157.978-81.302 0-27.297-26.105-51.464-66.135-66.232 38.089-32.123 64.889-72.053 75.631-116.21 27.251 40.527 56.29 62.605 74.887 52.909 26.95-14.073 21.631-89.456-12.032-168.37-26.355-62.058-62.11-107.754-89.457-117.848 0.398-3.929 0.596-7.958 0.596-11.935 0-23.968-6.661-46.146-18.049-64.196 0.199-1.393 0.199-2.834 0.199-4.227 0-11.038-2.636-21.381-7.114-30.332-6.909-161.309-111.93-289.402-281.866-289.402-170.036 0-275.106 128.093-281.943 289.402-4.525 9.001-7.135 19.343-7.135 30.332 0 1.393 0.099 2.835 0.15 4.227-11.288 18.05-17.951 40.178-17.951 64.196 0 3.978 0.15 7.955 0.498 11.935-27.151 10.094-63.028 55.841-89.333 117.848z"
                        fill="#ffffff"
                        p-id="6693"></path>
                </svg>
                <a
                    class="link link-hover ml-1"
                    href="https://qm.qq.com/q/SslCMd4XO6"
                    target="_blank">
                    QQ</a
                >
            </div>
        </nav>
    </footer>

    <div class="bg-neutral text-neutral-content">
        <div class="py-2 text-center">Copyright © 2024 月离万事屋</div>
    </div>
</template>

<script setup lang="ts">
const basic = basicStore()
let { isAdmin, locale, nickname } = storeToRefs(basic)

const appVersion = ref('')

async function refreshDB() {
    try {
        localStorage.setItem('appVersion', appVersion.value)
        await dbManager.clearDatabase()
        Message({ message: 'Database refresh successfully' })
        console.log('Database refresh successfully')
    } catch (error) {
        Message({ message: 'Failed to clear database', type: 'warn' })
        console.error('Failed to clear database:', error)
    }
}

onMounted(async () => {
    // 初始化token
    const localToken = localStorage.getItem('token')
    if (localToken) {
        await fetchHandleBasicCallback(
            isAdmin,
            false,
            fetchCheckToken,
            localToken,
            'data',
            async () => {
                isAdmin.value = true
            },
            async () => {
                isAdmin.value = false
                localStorage.removeItem('token')
            }
        )
    } else {
        localStorage.removeItem('token')
    }

    // 读取本地语言/昵称
    // initLocalStorageParam(locale, 'zh', 'locale')
    // initLocalStorageParam(nickname, 'zh', '看书大王')

    // 读取本地数据库
    const appVersionLocal = localStorage.getItem('appVersion')
    if (appVersionLocal) {
        await fetchHandleBasic(appVersion, '', getAppVersion)
        if (appVersionLocal != appVersion.value) {
            await refreshDB()
        }
    } else {
        await fetchHandleBasic(appVersion, '', getAppVersion)
        await refreshDB()
    }
})
</script>
